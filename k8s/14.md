# Lab 14

## Kube Prometheus Stack components

- The Prometheus Operator

Provides Kubernetes native deployment, management of Prometheus and related monitoring components. Needed to simplify and automate the configuration of a Prometheus for Kubernetes.

- Highly available Prometheus

Open source technology, used for monitoring and alerting cloud environments.

- Highly available Alertmanager

Used to handle alerts from client applications, for example, Prometheus.

- Prometheus node-exporter

Used to export Prometheus for hardware and OS metrics.

- Prometheus Adapter for Kubernetes Metrics APIs

This is an implementation of the Kubernetes resource metrics, custom metrics, and external metrics APIs.

- kube-state-metrics

Service that generates metrics listening to Kubernetes API

- Grafana

Open source application, used to analyze and vizualize web applications.

## ```kubectl get po,sts,svc,pvc,cm```

po - Pod
sts - StatefulSet
svc - Service
pvc - PersistentVolumeClaim
cm - ConfigMap

```bash
NAME                                                         READY   STATUS    RESTARTS       AGE
pod/alertmanager-main-kube-prometheus-stack-alertmanager-0   2/2     Running   1 (11m ago)    11m
pod/app-python-0                                             1/1     Running   0              10m
pod/app-python-1                                             1/1     Running   0              10m
pod/main-grafana-7859fdf988-vxj8r                            3/3     Running   0              11m
pod/main-kube-prometheus-stack-operator-6c477f97c4-sf8wl     1/1     Running   0              11m
pod/main-kube-state-metrics-6447948f45-9kxhw                 1/1     Running   0              11m
pod/main-prometheus-node-exporter-p2q82                      1/1     Running   0              11m
pod/prometheus-main-kube-prometheus-stack-prometheus-0       2/2     Running   0              11m

NAME                                                                    READY   AGE
statefulset.apps/alertmanager-main-kube-prometheus-stack-alertmanager   1/1     11m
statefulset.apps/app-python                                             2/2     10m
statefulset.apps/prometheus-main-kube-prometheus-stack-prometheus       1/1     11m

NAME                                              TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)                      AGE
service/alertmanager-operated                     ClusterIP      None             <none>        9093/TCP,9094/TCP,9094/UDP   11m
service/app-python                                LoadBalancer   10.96.151.52     <pending>     80:31026/TCP                 10m
service/kubernetes                                ClusterIP      10.96.0.1        <none>        443/TCP                      15m
service/main-grafana                              ClusterIP      10.106.195.19    <none>        80/TCP                       11m
service/main-kube-prometheus-stack-alertmanager   ClusterIP      10.109.167.202   <none>        9093/TCP                     11m
service/main-kube-prometheus-stack-operator       ClusterIP      10.101.223.83    <none>        443/TCP                      11m
service/main-kube-prometheus-stack-prometheus     ClusterIP      10.106.70.146    <none>        9090/TCP                     11m
service/main-kube-state-metrics                   ClusterIP      10.102.38.71     <none>        8080/TCP                     11m
service/main-prometheus-node-exporter             ClusterIP      10.104.232.70    <none>        9100/TCP                     11m
service/prometheus-operated                       ClusterIP      None             <none>        9090/TCP                     11m

NAME                                                                    STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
persistentvolumeclaim/app-python-volume-app-python-0                    Bound    pvc-bddf6f9a-0de0-436c-8d72-02f04247dcb6   256Mi      RWO            standard       10m
persistentvolumeclaim/app-python-volume-app-python-1                    Bound    pvc-1ef73a89-b6aa-472f-93b7-b647531358e4   256Mi      RWO            standard       10m

NAME                                                                     DATA   AGE
configmap/app-python-config                                              1      10m
configmap/kube-root-ca.crt                                               1      15m
configmap/main-grafana                                                   1      11m
configmap/main-grafana-config-dashboards                                 1      11m
configmap/main-kube-prometheus-stack-alertmanager-overview               1      11m
configmap/main-kube-prometheus-stack-apiserver                           1      11m
configmap/main-kube-prometheus-stack-cluster-total                       1      11m
configmap/main-kube-prometheus-stack-controller-manager                  1      11m
configmap/main-kube-prometheus-stack-etcd                                1      11m
configmap/main-kube-prometheus-stack-grafana-datasource                  1      11m
configmap/main-kube-prometheus-stack-grafana-overview                    1      11m
configmap/main-kube-prometheus-stack-k8s-coredns                         1      11m
configmap/main-kube-prometheus-stack-k8s-resources-cluster               1      11m
configmap/main-kube-prometheus-stack-k8s-resources-namespace             1      11m
configmap/main-kube-prometheus-stack-k8s-resources-node                  1      11m
configmap/main-kube-prometheus-stack-k8s-resources-pod                   1      11m
configmap/main-kube-prometheus-stack-k8s-resources-workload              1      11m
configmap/main-kube-prometheus-stack-k8s-resources-workloads-namespace   1      11m
configmap/main-kube-prometheus-stack-kubelet                             1      11m
configmap/main-kube-prometheus-stack-namespace-by-pod                    1      11m
configmap/main-kube-prometheus-stack-namespace-by-workload               1      11m
configmap/main-kube-prometheus-stack-node-cluster-rsrc-use               1      11m
configmap/main-kube-prometheus-stack-node-rsrc-use                       1      11m
configmap/main-kube-prometheus-stack-nodes                               1      11m
configmap/main-kube-prometheus-stack-nodes-darwin                        1      11m
configmap/main-kube-prometheus-stack-persistentvolumesusage              1      11m
configmap/main-kube-prometheus-stack-pod-total                           1      11m
configmap/main-kube-prometheus-stack-prometheus                          1      11m
configmap/main-kube-prometheus-stack-proxy                               1      11m
configmap/main-kube-prometheus-stack-scheduler                           1      11m
configmap/main-kube-prometheus-stack-workload-total                      1      11m
configmap/prometheus-main-kube-prometheus-stack-prometheus-rulefiles-0   19     11m
```

## Grafana

### i.Check how much CPU and Memory your StatefulSet is consuming

![cpu](/k8s/assets/CPU.png)

![mem](/k8s/assets/Memory.png)

### ii.Check which Pod is using CPU more than others and which is less in the default namespace

![pods](/k8s/assets/pods.png)

### iii.Check how much memory is used on your node, in % and mb

![mem](/k8s/assets/mem.png)

![mem2](/k8s/assets/mem2.png)

### iv.Check how many pods and containers actually ran by the Kubelet service

![num](/k8s/assets/num.png)

### v.Check which Pod is using network more than others and which is less in the default namespace

![network](/k8s/assets/network.png)

### vi.Check how many alerts you have. Also you can see them in the Web UI by the minikube service monitoring-kube-prometheus-alertmanager command

![alerts](/k8s/assets/alerts.png)

## Init Containers

![1](/k8s/assets/14-1.png)

![2](/k8s/assets/14-2.png)

## Bonus

![b1](/k8s/assets/b1.png)
